# JMComic QQ 机器人

一个基于 NapCat 的 QQ 机器人，可以帮助用户下载、管理和分享禁漫天堂的漫画内容。支持漫画下载、查询和发送功能，并提供友好的交互界面。

## 功能特性

- **漫画下载**: 通过漫画ID一键下载漫画
- **漫画发送**: 发送已下载的漫画文件到QQ聊天
- **下载状态查询**: 实时查询下载进度和状态
- **已下载漫画列表**: 查看已下载的漫画内容
- **自动PDF转换**: 支持将下载的图片转换为PDF格式
- **异步处理**: 多线程处理下载任务，不阻塞其他功能
- **通信方式**: 支持WebSocket和HTTP两种通信方式
- **自动重连**: 网络断开时自动尝试重连，保持稳定连接
- **日志系统**: 彩色日志输出，便于问题排查
- **安全认证**: 支持Token验证，保护API安全
- **自定义配置**: 灵活的下载参数配置

## 环境要求

- Python 3.7 或更高版本
- Windows 操作系统（NapCat目前仅支持Windows）
- 稳定的网络连接
- 存储空间（根据下载漫画数量决定）

## 安装步骤

### 使用IDE的安装方式（推荐开发者）

1. 克隆或下载项目代码
2. 打开项目文件夹
3. 安装依赖：
   ```bash
   pip install -r requirements.txt
   ```

### 无IDE环境下的安装方式（普通用户）

1. **安装Python**：
   - 访问 https://www.python.org/downloads/ 下载并安装最新版Python
   - 安装时勾选「Add Python to PATH」选项
   - 验证安装：打开命令提示符，输入 `python --version`，应显示Python版本号

2. **下载项目文件**：
   - 下载项目压缩包并解压到本地文件夹（例如：`D:\JMComicBot\`）

3. **安装依赖**：
   - 按下 `Win + R` 键，输入 `cmd` 打开命令提示符
   - 进入项目目录：`cd D:\JMComicBot\`
   - 输入命令：`pip install -r requirements.txt`
   - 等待安装完成

## 配置说明

### 1. 环境变量配置（无IDE用户可使用记事本编辑）

创建或编辑 `.env` 文件，包含以下配置：

```
# NapCat WebSocket 服务配置
NAPCAT_WS_URL=ws://localhost:6099/wsapi

# Flask HTTP 服务配置
FLASK_HOST=127.0.0.1
FLASK_PORT=8000

# 漫画下载路径
MANGA_DOWNLOAD_PATH=./downloads (这是当前的根目录)

# 安全认证 Token（可选，建议设置）
TOKEN=your_secure_token_here

# 日志级别（DEBUG, INFO, WARNING, ERROR）
LOG_LEVEL=INFO
```

**无IDE环境配置方法**：
1. 在项目文件夹中，右键点击空白处 → 新建 → 文本文档
2. 将上述内容复制进去
3. 点击「文件」→「另存为」
4. 文件名输入 `.env`（注意：包含开头的点）
5. 文件类型选择「所有文件」
6. 点击「保存」

### 2. JMComic 下载配置

如需自定义漫画下载参数：
1. 复制 `option_example.yml` 文件并重命名为 `option.yml`
2. 根据需要修改配置参数


### 3. NapCat 配置

1. **安装 NapCat**：
   - 下载并安装 NapCat：https://github.com/NapNeko/NapCatQQ
   - 启动 NapCat 并扫码登录 QQ 账号

2. **配置 WebSocket 服务**：
   - 访问 NapCat 的 WebUI（默认地址：http://localhost:6099/webui?token=你的token）
   - 在「网络配置」→「WebSocket 服务端」中创建服务
   - 配置与 `.env` 文件中的 `NAPCAT_WS_URL` 匹配

3. **快速配置方法**：
   - 可以参考项目中的 `napcat_config_example.yml` 文件
   - 复制其中的配置到 NapCat 的配置文件中

**无IDE环境配置方法**：
- 打开 NapCat 安装目录
- 找到配置文件（通常为 `config.yml`）
- 使用记事本打开并编辑相关配置

## 使用方法

### 启动机器人

#### 使用IDE启动
- 运行 `bot.py` 文件

#### 无IDE环境启动（推荐普通用户）
- 双击运行项目中的 `start.bat` 文件
- 或者通过命令行：
  ```
  # 打开命令提示符
  cd D:\JMComicBot\  # 替换为你的项目路径
  python bot.py
  ```

### QQ命令使用

在QQ群或私聊中发送以下命令：

#### 帮助命令
- `漫画帮助` - 查看所有可用命令和使用说明

#### 下载命令
- `漫画下载 [漫画ID]` - 下载指定ID的漫画
  示例：`漫画下载 422866`

#### 发送命令
- `发送 [漫画ID]` - 发送已下载的漫画文件
  示例：`发送 422866`

#### 查询命令
- `查询已下载漫画` - 查看所有已下载的漫画列表
- `查询漫画 [漫画ID]` - 查询指定ID漫画的存在状态

#### 其他命令
- `你好`/`hi`/`hello`/`在吗` - 机器人回复欢迎信息

### 实际使用流程

1. **启动机器人**：运行 `start.bat` 或 `python bot.py`
2. **下载漫画**：在QQ中发送 `漫画下载 [ID]`
3. **等待完成**：下载完成后会收到通知消息
4. **获取漫画**：发送 `发送 [ID]` 获取已下载的漫画文件
5. **查看帮助**：遇到问题时发送 `漫画帮助` 获取详细指引

## 常见问题解答

### 1. 机器人无响应怎么办？
- 检查NapCat是否正常在线
- 确认WebSocket配置是否正确
- 查看机器人终端窗口是否有错误信息

### 2. 下载漫画失败怎么办？
- 检查网络连接是否正常
- 确认漫画ID是否正确
- 查看是否有权限访问禁漫天堂网站

### 3. 发送漫画文件失败怎么办？
- 确认漫画是否已成功下载
- 检查文件大小是否超过QQ限制
- 尝试分批发送大文件

### 4. 如何找到漫画ID？
- 在禁漫天堂网站浏览漫画时，URL中的数字即为漫画ID
- 例如：`https://jm-comic.org/photo/422866/` 中的 `422866` 就是漫画ID

### 5. 无IDE环境下如何修改配置？
- 使用Windows自带的记事本编辑配置文件
- 保存时注意文件类型和文件名（如 `.env` 需要保存为「所有文件」类型）

## 故障排除

### 日志查看
- 机器人启动后，终端窗口会显示彩色日志
- ERROR级别（红色）表示错误信息
- WARNING级别（黄色）表示警告信息
- INFO级别（蓝色）表示正常运行信息
- DEBUG级别（青色）表示详细调试信息

### 常见错误及解决方案

**1. WebSocket连接失败**
- 检查NapCat是否运行
- 确认 `.env` 中的 `NAPCAT_WS_URL` 是否正确
- 检查防火墙设置，确保端口开放

**2. 依赖安装失败**
- 更新pip：`python -m pip install --upgrade pip`
- 尝试使用国内镜像源：`pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple`

**3. 权限错误**
- 以管理员身份运行命令提示符
- 检查文件和文件夹权限设置

**4. 下载速度慢**
- 检查网络连接
- 考虑修改JMComic配置，调整并发设置

## 注意事项

- **法律合规**: 请遵守相关法律法规，合理使用本工具
- **网络环境**: 确保您的网络环境可以访问目标网站
- **存储空间**: 漫画下载会占用大量空间，请确保有足够的存储空间
- **下载时间**: 大文件下载可能需要较长时间，请耐心等待
- **安全配置**: 生产环境建议启用Token验证以提高安全性
- **定期更新**: 定期检查并更新项目以获取新功能和修复

## 依赖项

- **websocket-client**: 用于WebSocket通信
- **jmcomic**: 用于漫画下载
- **requests**: 用于HTTP请求
- **python-dotenv**: 用于加载环境变量
- **flask**: 用于接收HTTP事件
- **PyPDF2**: 用于PDF处理（如有需要）

## 更新日志

### 最新版本
- 添加彩色日志输出，提高可读性
- 优化下载和发送流程
- 增强错误处理机制
- 支持PDF转换功能

## 许可证

本项目仅供学习和研究使用。使用本工具时，请遵守相关法律法规，尊重原创内容版权。

## 免责声明

本项目仅作为技术学习和研究用途，作者不对任何不当使用本工具造成的后果负责。请用户自行承担使用风险，并确保遵守所在国家或地区的相关法律法规。